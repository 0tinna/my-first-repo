脚本语言练习指南：Bash 与 Python
======================

本指南提供从入门到实战的脚本练习示例，帮助你掌握 Bash 与 Python 编程，用于自动化运维与小工具开发。

* * *

一、Bash 入门实战
-----------

### 1. 基础语法与执行

```vim
# 创建脚本文件
touch hello.sh
chmod +x hello.sh

# 写入内容
cat << 'EOF' > hello.sh
#!/usr/bin/env bash

echo "Hello, World!"
EOF

# 执行脚本
./hello.sh
```

### 2. 变量与用户输入

```vim
#!/usr/bin/env bash

# 定义变量
greet="你好"
name="$1"    # 从参数获取姓名
echo "$greet, $name！"

# 运行：
# ./hello.sh Alice  # 输出：你好, Alice！
```

### 3. 条件与循环

```vim
#!/usr/bin/env bash

# 判断文件是否存在
file="/tmp/test.txt"
if [[ -f $file ]]; then
  echo "$file 存在"
else
  echo "$file 不存在，创建之"
  touch $file
fi

# 循环遍历目录
for item in /var/log/*.log; do
  echo "日志文件：$item"
done
```

### 4. 函数与模块化

```vim
#!/usr/bin/env bash

function backup() {
  src=$1; dest=$2
  tar czf "${dest}/$(basename $src).tar.gz" "$src"
  echo "备份 $src 到 $dest 成功"
}

# 调用函数
backup "/etc" "/backup"
```

### 5. 实战示例：批量服务监控脚本

```vim
#!/usr/bin/env bash

SERVICES=(nginx mysql redis)
for svc in "${SERVICES[@]}"; do
  if systemctl is-active --quiet "$svc"; then
    echo "[OK] $svc 运行中"
  else
    echo "[WARN] $svc 未运行，正在重启..."
    systemctl restart "$svc"
  fi
done
```

* * *

二、Python 入门实战
-------------

### 1. 基础语法与运行

```vim
# 创建脚本 hello.py
def main():
    print("Hello, Python World!")

if __name__ == '__main__':
    main()

# 运行：
# python3 hello.py
```

### 2. 变量、列表与循环

```vim
# 列表遍历
names = ['Alice', 'Bob', 'Carol']
for name in names:
    print(f"你好, {name}！")
```

### 3. 条件与用户输入

```vim
# 判断输入类型
age = int(input("请输入年龄："))
if age >= 18:
    print("你已成年")
else:
    print("你未成年")
```

### 4. 函数与模块划分

```vim
# utils.py
 def backup(src: str, dest: str):
     import tarfile, os
     base = os.path.basename(src.rstrip('/'))
     archive = f"{dest}/{base}.tar.gz"
     with tarfile.open(archive, 'w:gz') as tf:
         tf.add(src, arcname=base)
     print(f"备份 {src} 到 {archive}")

# main.py
from utils import backup
if __name__ == '__main__':
    backup('/etc', '/backup')
```

### 5. 实战示例：日志监控与告警

    #!/usr/bin/env python3
    import time, smtplib
    from email.message import EmailMessage
    LOG_FILE = '/var/log/app.log'
    KEYWORD = 'ERROR'
    
    def send_alert(line):
        msg = EmailMessage()
        msg['Subject'] = '日志错误告警'
        msg.set_content(f"检测到日志错误: {line}")
        with smtplib.SMTP('smtp.server.com') as smtp:
            smtp.send_message(msg)
    
    if __name__ == '__main__':
        with open(LOG_FILE) as f:
            f.seek(0, 2)  # 移动到文件末尾
            while True:
                line = f.readline()
                if not line:
                    time.sleep(1)
                    continue
                if KEYWORD in line:
                    send_alert(line)

* * *

三、实践建议
------

1. **每练必测**：每次脚本修改后，应在测试环境或本地虚拟机验证功能。

2. **版本管理**：使用 git 管理脚本版本，撰写清晰 commit 日志。

3. **持续优化**：增加日志、错误处理与单元测试，确保脚本健壮性。

4. **文档维护**：为关键脚本编写 README，注明用途、参数与运行方式。

通过以上循序渐进练习，你将能熟练编写 Bash 与 Python 自动化脚本，满足日常运维与小工具开发需求。祝编程愉快！
